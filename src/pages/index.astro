---
import Layout from '../layouts/Layout.astro';
import '../styles/global.css';
import ColorButton from '../components/ColorButton.astro';
import Section from '../components/Section.astro';
import TabBar from '../components/TabBar.astro';
import BentoGrid from '../components/BentoGrid.astro';
import StickyNav from '../components/StickyNav.astro';

// Cargamos todos los archivos Markdown
const allWorks = await Astro.glob('./works/*.md');

// Definimos las pestañas
const menuTabs = [
  {id: 'dev', label: 'Desarrollo Web'},
  {id: 'design', label: 'Diseño UX/UI'},
  {id: 'content', label: 'Contenido Digital'},
];

const misRedes = {
    linkedin: "https://www.linkedin.com/in/abisai-ruiz/",
    github: "https://github.com/RuiloAbyss/",
    cv: "/CV_Abisai_Ruiz Lopez.pdf"
};

const getWorksByCategory = (categoryId) => {
  return allWorks.filter(post => post.frontmatter.category === categoryId);
}
---

<Layout>
    {/* Sección de Introducción */}
    <div id="profile-trigger" class="w-[100%] flex flex-col sm:flex-row sm:items-stretch justify-between"> 
        <div class="w-[100%] sm:w-full h-full sm:pr-[20px]"> 
            <Section title="">
                <div class=" h-full flex flex-col sm:flex-row items-center sm:items-start justify-center gap-2"> 
                    <div class="flex justify-center sm:justify-start">
                        <img 
                            src="/public/profile.png" 
                            alt="Foto de Perfil" 
                            class="aspect-square w-[200px] sm:w-[170px] mx-4 my-4 rounded-full sm:border-5 border-10 p-1 border-white/20 border-t-orange-900/80 border-r-orange-500/40 ]"
                        />
                    </div>
                    <div class="flex flex-col items-center sm:items-start text-center m- sm:m-0 sm:w-[100%] sm:mt-2 sm:ml-10 sm:text-left">
                        <h3 class="font-bold text-white">Abisai Ruiz López</h3>
                        <h6 class="text-red-400">Desarrollador web con sentido de diseño</h6>
                        <p class="text-white">Aquí va la información adicional o el texto más largo que habla de ti</p>
                    </div> 
                </div>
            </Section>
        </div> 
        
        <div class="w-[100%] sm:w-[20%] flex flex-col"> 
            <Section class="flex flex-col">
                <div class="flex justify-center sm:justify-end flex-row gap-1 w-[100%] h-full sm:flex-col sm:gap-3"> 
                    <ColorButton label="Curriculum" theme="sunset" href={misRedes.cv}/>
                    <ColorButton label="LinkedIn" theme="void" href={misRedes.linkedin}/>
                    <ColorButton label="GitHub" theme="cosmic" href={misRedes.github}/>
                </div>
            </Section>
        </div>
    </div>
	
    {/* --- TabBar con Bento Grid Integrado --- */}
    <div id="tabbar-trigger"></div>
        <TabBar tabs={menuTabs} initialTabId="dev" theme="sunset" class="my-2">
            {menuTabs.map((tab) => {
                const works = getWorksByCategory(tab.id);
                
                // Convertimos el formato de Markdown al formato plano que espera BentoGrid/Card
                const bentoItems = works.map(post => ({
                    title: post.frontmatter.title,
                    imglink: post.frontmatter.image,     
                    content: post.frontmatter.description, 
                    href: post.url,                    
                    theme: post.frontmatter.theme,
                    technologies: post.frontmatter.tags || []
                }));

                // Lógica de visualización
                const initialDisplay = tab.id === 'dev' ? 'block' : 'none'; // Usamos block en lugar de grid, porque BentoGrid ya tiene su propio grid

                return (
                    <div 
                        data-slot-id={tab.id} 
                        style={`display: ${initialDisplay};`} 
                    >
                        {works.length > 0 ? (
                            // Aquí simplemente pasamos los items procesados
                            <BentoGrid items={bentoItems} />
                        ) : (
                            <div class="text-center py-10 opacity-50">
                                <p>Próximamente más proyectos en esta categoría.</p>
                            </div>
                        )}
                    </div>
                );
            })}
        </TabBar>
    </div>
    {/* Agregamos el componente nuevo al final */}
    <StickyNav 
        name="Abisai Ruiz López"
        avatar="/public/dot.png"
        socialLinks={misRedes}
        tabs={menuTabs}
    />
</Layout>