---
// src/pages/index.astro
import Layout from '../layouts/Layout.astro';
import '../styles/global.css';
import ColorButton from '../components/ColorButton.astro';
import Section from '../components/Section.astro'
import Card from '../components/Card.astro';
import TabBar from '../components/TabBar.astro';

// 1. Cargamos todos los archivos Markdown de la carpeta works usando Astro.glob
const allWorks = await Astro.glob('./works/*.md');

// Definimos las pesta침as (IDs deben coincidir con 'category' en el markdown)
const menuTabs = [
  { id: 'dev', label: 'Desarrollo Web', icon: '游눹' },
  { id: 'design', label: 'Dise침o UX/UI', icon: '游꿛' },
  { id: 'content', label: 'Contenido Digital', icon: '九꽲잺' },
];

// 2. Funci칩n auxiliar para filtrar proyectos por categor칤a
const getWorksByCategory = (categoryId) => {
  return allWorks.filter(post => post.frontmatter.category === categoryId);
}
---

<Layout>
    {/* Secci칩n de Introducci칩n (Sin cambios) */}
    <div class="w-[100%] flex flex-col sm:flex-row sm:items-stretch justify-between"> 
        <div class="w-[100%] sm:w-full h-full sm:pr-[20px]"> 
            <Section title="">
                <div class=" h-full flex flex-col sm:flex-row items-center sm:items-start justify-center gap-2"> 
                    <div class="flex justify-center sm:justify-start">
                        <img 
                            src="/public/profile.png" 
                            alt="Foto de Perfil" 
                            class="aspect-square w-[200px] sm:w-[170px] mx-4 mb-5 rounded-full shadow-[0_0_15px_8px_rgba(0,0,0,1)]"
                        />
                    </div>
                    <div class="flex flex-col items-center sm:items-start text-center sm:w-[100%] sm:ml-10 sm:text-left">
                        <h3 class="text-3xl font-bold text-white">Abisai Ruiz L칩pez</h3>
                        <p class="text-lg text-red-400 mt-2">Desarrollador web con sentido de dise침o</p>
                        <p class="text-white">Aqu칤 va la informaci칩n adicional o el texto m치s largo que habla de ti</p>
                    </div> 
                </div>
            </Section>
        </div> 
        
        <div class="w-[100%] sm:w-[20%] flex flex-col"> 
            <Section title="Links" class="flex flex-col">
                <div class="flex justify-center sm:justify-end flex-row gap-1 w-[100%] h-full sm:flex-col sm:gap-3"> 
                    <ColorButton label="Curriculum" theme="sunset" href="https://www.google.com/"/>
                    <ColorButton label="LinkedIn" theme="void" href="https://www.google.com/"/>
                    <ColorButton label="GitHub" theme="cosmic" href="https://github.com/RuiloAbyss/"/>
                </div>
            </Section>
        </div>
    </div>
	
    {/* --- TabBar con Contenido Din치mico --- */}
	<TabBar tabs={menuTabs} initialTabId="dev" theme="sunset" class="my-5">
		
        {menuTabs.map((tab) => {
            // Filtramos los trabajos para la pesta침a actual
            const works = getWorksByCategory(tab.id);
            
            // L칩gica de visualizaci칩n inicial para que no parpadee al cargar
            // El TabBar controla la visibilidad despu칠s, pero esto ayuda al renderizado inicial
            const initialDisplay = tab.id === 'dev' ? 'grid' : 'none';

            return (
                <div 
                    data-slot-id={tab.id} 
                    style={`display: ${initialDisplay}; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem;`}
                >
                    {works.length > 0 ? (
                        works.map((post) => (
                            <Card
                                title={post.frontmatter.title}
                                imglink={post.frontmatter.image} 
                                content={post.frontmatter.description}
                                href={post.url+""} 
                                theme={post.frontmatter.theme}
                                technologies={post.frontmatter.tags || []} 
                            />
                        ))
                    ) : (
                        // Mensaje opcional si no hay proyectos en esa categor칤a
                        <div class="col-span-full text-center py-10 opacity-50">
                            <p>Pr칩ximamente m치s proyectos en esta categor칤a.</p>
                        </div>
                    )}
                </div>
            );
        })}

	</TabBar>
</Layout>